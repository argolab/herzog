{% extends "solo.html" %}

{% block title %} {{topic.title}} - {{config.SITE_NAME}} {% endblock %}

{% block bodycls %} page-topic{% endblock %}

{% block header %}
  <script id="seajsnode" src="{{url_for('static', filename='js/seajs/sea.js')}}"></script>
  <script src="{{url_for('static', filename='js/herzog.config.js')}}"></script>
{% endblock %}

{% block tail %}
  <script>
   seajs.use("page/topic");
  </script>
{% endblock %}

{% block container %}

  <div class="container">
    <div class="primary">
      <div class="mod-topic-lz">
        <div class="col-left">
          <img class="avatar" title="{{topic.owner}}"
               src="{{url_for_avatar(topic.owner)}}"/>
        </div>
        <div class="col-main">
          <div class="header">
            <h3>{{-topic.title-}}</h3>
            <div class="username">
              <a class="owner text-iter" href="{{topic.owner}}"
                 title="点击到 {{topic.owner}} 的个人资料页面">
                {{-topic.owner-}}
              </a>
              <span class="time text-alt">{{topic.lastupdate}}</span>
            </div>
          </div>
          <div class="typo">
            {{topic.content|postHtml|safe}}
          </div>
          <div class="row">
            <ul class="list">
              <li><a class="btn" href="#">赞 {{topic.replynum}}</a></li>
              <li><a class="text-iter2" href="#">关注</a></li>
              <li><a class="text-iter2" href="#">分享</a></li>
            </ul>
          </div>
        </div>
        <hr>
      </div>

      <div id="replys">
        {% if replys %}
          {% for r in replys %}
            <div id="reply-{{r.rid}}" class="row mod-topic-reply">
              <div class="col-left">
                <img class="avatar" title="{{r.owner}}"
                     src="{{url_for_avatar(r.owner)}}" />
              </div>
              <div class="col-main">
                <div class="header">
                  <a class="owner text-iter" href="{{r.owner}}"
                     title="点击到 {{r.owner}} 的个人资料页面">
                    {{-r.owner-}}
                  </a>
                  <span class="time text-alt">{{r.lastupdate}}</span>
                </div>
                <div class="post-content">
                  {{r.content|postHtml|safe}}
                </div>
                <div class="row">
                  <ul class="list reply-action">
                    <li><a data-rid="{{r.rid}}" data-do="good" class="text-iter2" href="javascript:;">赞</a></li>
                    <li><a data-rid="{{r.rid}}" data-do="comment" class="text-iter2" href="javascript:;">回复</a></li>
                  </ul>
                </div>
                <div class="mod-topic-comments{% if not r.comments %} empty{% endif %}">
                  {% for c in r.comments %}
                    <div class="comment">
                      <div class="r1">
                        <a class="owner" href="{{c.owner}}"
                           title="点击到 {{c.owner}} 的个人资料页面">
                          {{-c.owner-}}
                        </a>
                        <span class="time text-alt">{{r.lastupdate}}</span>
                      </div>
                      <div class="content row">
                        {{c.content|postHtml|safe}}
                        <ul class="list comment-actions">
                          <li><a data-brid="{{r.rid}}" data-rid="{{c.rid}}" data-toreply="{{c.owner}}" data-do="commentComment" class="text-iter2" href="#">回复</a></li>
                        </ul>
                      </div>
                    </div>
                  {% endfor %}
                </div>
              </div>
              <hr/>
            </div>
          {% endfor %}
        {% endif %}
      </div>

      <div class="mod-topic-editor-reply" id="editor-reply" data-tid="{{topic.tid}}" data-action="{{url_for('ajax_reply')}}" data-fetch="{{url_for('ajax_get_reply')}}">
        <div id="editarea-reply" tabindex="0" class="editarea" contentEditable="true"></div>
        <div class="row">
          <a class="text-alt reset" href="javascript:;" id="reset-reply">取消</a>
          <div class="btn btn-reverse submit">
            提交
          </div>
        </div>
      </div>      
    </div>

    <div class="aside">
      <div class="widgets">
        <div class="mod-topic-fromboard text-alt">
          来自
          <em class="text-iter">女孩子<small class="text-alt">Girls</small></em>
        </div>

        <div class="mod-topic-guess">
          <div class="mod-title">
            <h3>本版话题推荐...</h3>
          </div>
          {% for p in relative %}
            <div class="outer">
              <div class="inner">
                <img class="custom" src="{{url_for_avatar(p.owner)}}" title="{{p.title}}"/>
                <a class="text text-small" href="{{url_for('topic', tid=p.tid)}}" title="{{p.title}}">{{p.title}}</a>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>

  </div>

  <script id="tpl-reply" type="text/html">
    <div id="reply-<%=reply.rid%>" class="row mod-topic-reply">
      <div class="col-left">
        <img class="avatar" title="<%=reply.owner%>"
             src="<%=reply.owner_avatar%>" />
      </div>
      <div class="col-main">
        <div>
          <a class="owner text-iter" href="<%=reply.owner%>"
             title="点击到 <%=reply.owner%> 的个人资料页面">
            <%=reply.owner%>
          </a>
          <span class="time text-alt"><%=reply.lastupdate%></span>
        </div>
        <div class="post-content">
          <%=#reply.html_content%>
        </div>
        <div class="row">
          <ul class="list reply-action">
            <li><a data-rid="<%=reply.rid%>" data-action="good" class="text-iter2" href="javascript:;">赞</a></li>
            <li><a data-rid="<%=reply.rid%>" data-action="comment" class="text-iter2" href="javascript:;">回复</a></li>
          </ul>
        </div>
        <div class="mod-topic-comments empty">
        </div>
      </div>
      <hr/>
    </div>
  </script>

  <script type="text/html" id="tpl-comment-editor" >
    <div class="mod-topic-editor-comment" data-replyid="<%=rid%>" data-action="{{url_for('ajax_reply')}}" data-fetch="{{url_for('ajax_get_reply')}}">
      <div class="editarea" tabindex="-1" contentEditable="true"><% if(toreply){ %>@<%=toreply%> <% }; %></div>
      <div class="row">
        <a data-do="cancelComment" data-rid="<%=rid%>" href="javascript:;" class="text-alt">取消</a>
        <div data-do="postComment" data-rid="<%=rid%>" class="submit btn btn-reverse">
          回复
        </div>
      </div>
    </div>
  </script>

  <script type="text/html" id="tpl-comment">
    <div class="comment">
      <div class="r1">
        <a class="owner" href="<%=reply.owner%>"
           title="点击到 <%=reply.owner%> 的个人资料页面"><%=reply.owner%></a>
        <span class="time text-alt"><%=reply.lastupdate%></span>
      </div>
      <div class="content row">
        <%=#reply.html_content%>
        <ul class="list comment-actions">
          <li><a data-brid="<%=reply.brid%>" data-rid="<%=reply.rid%>" data-toreply="<%=reply.owner%>" data-do="commentComment" class="text-iter2" href="#">回复</a></li>
        </ul>
      </div>
    </div>
  </script>

{% endblock %}
